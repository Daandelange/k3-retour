(()=>{(function(){"use strict";var F=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"dates"},[r("k-button-group",[r("k-button",{attrs:{icon:"calendar"}},[t._v(" "+t._s(t.label)+" ")])],1)],1)},R=[],ge="";function n(t,e,r,s,a,u,c,$e){var i=typeof t=="function"?t.options:t;e&&(i.render=e,i.staticRenderFns=r,i._compiled=!0),s&&(i.functional=!0),u&&(i._scopeId="data-v-"+u);var l;if(c?(l=function(o){o=o||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!o&&typeof __VUE_SSR_CONTEXT__!="undefined"&&(o=__VUE_SSR_CONTEXT__),a&&a.call(this,o),o&&o._registeredComponents&&o._registeredComponents.add(c)},i._ssrRegister=l):a&&(l=$e?function(){a.call(this,(i.functional?this.parent:this).$root.$options.shadowRoot)}:a),l)if(i.functional){i._injectStyles=l;var ye=i.render;i.render=function(be,C){return l.call(C),ye(be,C)}}else{var O=i.beforeCreate;i.beforeCreate=O?[].concat(O,l):[l]}return{exports:t,options:i}}const P={props:{dates:Object,timespan:Object},computed:{label(){const t=this.dates.from,e=this.dates.to;return this.timespan.unit==="day"?`${t.format("D")} ${this.month(t)} ${t.format("YYYY")}`:this.timespan.unit==="month"?`${this.month(t)} ${t.format("YYYY")}`:this.timespan.unit==="year"?`${t.format("YYYY")}`:t.isSame(e,"month")?`
        ${t.format("D")} - ${e.format("D")}
        ${this.month(e)} ${e.format("YYYY")}
        `:t.isSame(e,"year")?`
        ${t.format("D")} ${this.month(t)} -
        ${e.format("D")} ${this.month(e)} ${e.format("YYYY")}
        `:`
      ${t.format("D")} ${this.month(t)} ${t.format("YYYY")} -
      ${e.format("D")} ${this.month(e)} ${e.format("YYYY")}`},value(){return Object.values(this.dates).map(t=>t.format("YYYY-MM-DD HH:mm:ss"))}},methods:{month(t){return t=t.format("MMMM"),t=this.$helper.string.lcfirst(t),this.$t("months."+t)}}},_={};var D=n(P,F,R,!1,A,null,null,null);function A(t){for(let e in _)this[e]=_[e]}var E=function(){return D.exports}(),L=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("k-button-group",{staticClass:"prevnext"},[r("k-button",{attrs:{icon:"angle-left",disabled:!t.hasPrev||t.isAll},on:{click:function(s){return t.onNavigate("subtract")}}}),t._l(["all","year","month","day"],function(s){return r("k-button",{key:s,attrs:{current:t.isCurrent(s),disabled:t.isDisabled(s)},on:{click:function(a){return t.set(s)}}},[t._v(" "+t._s(t.$t("retour.stats.mode."+s))+" ")])}),r("k-button",{attrs:{icon:"angle-right",disabled:!t.hasNext||t.isAll},on:{click:function(s){return t.onNavigate("add")}}})],2)},N=[],ke="";const I={props:{dates:Object,timespan:Object},computed:{first(){return this.$library.dayjs(this.timespan.first)},last(){return this.$library.dayjs(this.timespan.last)},hasPrev(){return this.dates.from.isAfter(this.first)},hasNext(){return this.dates.to.isBefore(this.last)||this.dates.to.isBefore(this.$library.dayjs())},isAll(){return this.dates.from.isSame(this.first,"day")&&this.dates.to.isSame(this.last,"day")}},methods:{isCurrent(t){return t==="all"?this.isAll:t===this.timespan.unit},isDisabled(t){return t==="all"&&(!this.timespan.first||!this.timespan.last)},set(t){if(t==="all")return this.$emit("navigate",{from:this.first,to:this.last});let e=Object.assign({},this.dates);t===this.timespan.unit&&(e={from:this.$library.dayjs(),to:this.$library.dayjs()}),this.$emit("navigate",{from:e.from.startOf(t),to:e.from.endOf(t)})},onNavigate(t){let e=this.timespan.unit,r=1;e==="week"&&(r=7,e="day"),this.$emit("navigate",{from:this.dates.from[t](r,e).startOf(e),to:this.dates.to[t](r,e).endOf(e)})}}},d={};var T=n(I,L,N,!1,H,null,null,null);function H(t){for(let e in d)this[e]=d[e]}var B=function(){return T.exports}(),U=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("k-view",{staticClass:"retour-navigation"},[r("header",{staticClass:"k-header"},[r("k-bar",{staticClass:"k-header-buttons",scopedSlots:t._u([{key:"left",fn:function(){return[r("dates",{attrs:{dates:t.dates,timespan:t.timespan},on:{navigate:t.navigate}})]},proxy:!0},{key:"right",fn:function(){return[r("prev-next",{attrs:{dates:t.dates,timespan:t.timespan},on:{navigate:t.navigate}})]},proxy:!0}])}),r("k-tabs",{attrs:{tab:t.tab,tabs:t.tabs}})],1)])},q=[],xe="";const V={components:{Dates:E,PrevNext:B},props:{tab:String,tabs:Array,timespan:Object},computed:{dates(){return{from:this.$library.dayjs(this.timespan.from),to:this.$library.dayjs(this.timespan.to)}}},methods:{navigate(t){this.$reload({query:{from:t.from.format("YYYY-MM-DD"),to:t.to.format("YYYY-MM-DD")}})}}},v={};var Z=n(V,U,q,!1,z,null,null,null);function z(t){for(let e in v)this[e]=v[e]}var W=function(){return Z.exports}(),X=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("figure",{staticClass:"chart-pie"},[r("div",{staticClass:"graph",style:"--gradient: "+t.gradient}),r("figcaption",[t._l(t.data,function(s){return[r("k-icon",{key:s.label+"-icon",style:"--color:"+s.color,attrs:{type:"circle"}}),r("div",{key:s.label+"-no"},[t._v(" "+t._s(new Intl.NumberFormat().format(s.data))+" ")]),r("div",{key:s.label+"-label"},[t._v(" "+t._s(s.label)+" ")])]})],2)])},K=[],we="";const G={props:{data:Array},computed:{gradient(){let t="",e=0;const r=this.total/180;for(let s=0;s<this.data.length;s++)t+=`${this.data[s].color} ${e}deg,`,e+=this.data[s].data/r,t+=`${this.data[s].color} ${e}deg,`;return t+="transparent 180deg",t},total(){return this.data.reduce((t,e)=>t+=e.data,0)}}},p={};var J=n(G,X,K,!1,Q,null,null,null);function Q(t){for(let e in p)this[e]=p[e]}var tt=function(){return J.exports}(),et=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("table",{staticClass:"chart-areas"},[r("thead",[r("tr",t._l(t.axisY,function(s){return r("th",{key:s},[t._v(" "+t._s(s)+" ")])}),0)]),r("tbody",t._l(t.data,function(s,a){return r("tr",{key:a,on:{dblclick:function(u){return t.onZoom(s)}}},t._l(s.areas,function(u,c){return r("td",{key:t.segmentInde+"_"+c,style:"--color: "+t.color(a,u)+"; "+t.clip(a,c)})}),0)}),0),r("tfoot",{attrs:{"data-less":t.data.length>30}},t._l(t.data,function(s){return r("tr",{key:s.label,attrs:{"data-current":t.isCurrent(s)},on:{dblclick:function(a){return t.onZoom(s)}}},[r("td",[t._v(t._s(t.label(s)))])])}),0)])},rt=[],Ye="";const st={props:{data:Array,timespan:Object},computed:{axisY(){const t=this.max/5;return[1,2,3,4,5].map(e=>{let r=e*t;return r>=1e3&&(r=Math.floor(r/100)/10+"k"),r})},format(){var t;return(t={day:"HH",week:"ddd",mnoth:"D",year:"MMM",months:"MMM YY"}[this.timespan.unit])!=null?t:"D MMM"},subunit(){var t;return(t={day:"hour",year:"month"}[this.timespan.unit])!=null?t:"day"},max(){let t=Math.max(...this.data.map(e=>e.areas.reduce((r,s)=>r+=s.data,0)));if(t>0){const e=t.toString().length,r=Math.pow(10,e)/4;return Math.ceil(t*1.1/r)*r}return 5}},methods:{bounds(t,e){const r=t.areas.slice(0,e).reduce((s,a)=>s+=a.data,0);return{path:r+t.areas[e].data,mask:r}},clip(t,e){let r=this.bounds(this.data[t],e),s={path:0,mask:0};return this.data[t+1]&&(s=this.bounds(this.data[t+1],e)),`--p0: ${r.path/this.max}; --p1: ${s.path/this.max}; --m0: ${r.mask/this.max}; --m1: ${s.mask/this.max};`},color(t,e){const r=this.data[t+1];if(r){const s=this.$library.dayjs(r.label),a=this.$library.dayjs();if(s.isAfter(a,this.subunit))return"transparent"}return e.color},isCurrent(t){const e=this.$library.dayjs();return this.$library.dayjs(t.label).isSame(e,this.subunit)},label(t){return this.$library.dayjs(t.label).format(this.format)},onZoom(t){const e=this.$library.dayjs(t.label);this.$reload({query:{from:e.startOf(this.subunit).format("YYYY-MM-DD"),to:e.endOf(this.subunit).format("YYYY-MM-DD")}})}}},h={};var at=n(st,et,rt,!1,nt,null,null,null);function nt(t){for(let e in h)this[e]=h[e]}var it=function(){return at.exports}(),ot=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("k-view",{staticClass:"retour-stats"},[r("pie",{attrs:{data:t.pie}}),r("timeline",{attrs:{data:t.areas,timespan:t.timespan}})],1)},lt=[],je="";const ut={components:{Pie:tt,Timeline:it},props:{data:Array,timespan:Object},computed:{areas(){return this.data.map(t=>({label:t.date,areas:[{data:t.redirected,color:"var(--color-focus)"},{data:t.resolved,color:"var(--color-border)"},{data:t.failed,color:"var(--color-negative)"}]}))},pie(){return[{data:this.data.reduce((t,e)=>t+=e.redirected,0),color:"var(--color-focus)",label:this.$t("retour.stats.redirected")},{data:this.data.reduce((t,e)=>t+=e.resolved,0),color:"var(--color-border)",label:this.$t("retour.stats.resolved")},{data:this.data.reduce((t,e)=>t+=e.failed,0),color:"var(--color-negative)",label:this.$t("retour.stats.failed")}]}}},f={};var ct=n(ut,ot,lt,!1,_t,null,null,null);function _t(t){for(let e in f)this[e]=f[e]}var dt=function(){return ct.exports}(),vt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("section",{staticClass:"list"},[r("header",[r("div"),t._t("button")],2),t.rows.length?r("k-table",{attrs:{columns:t.columns,index:t.limit*(t.page-1)+1,options:t.options,rows:t.paginatedRows},on:{cell:function(s){return t.$emit("cell",s)},header:function(s){return t.$emit("header",s)},input:function(s){return t.$emit("input",s)},option:t.onOption}}):r("k-empty",{attrs:{layout:"cards"}},[t._v(" "+t._s(t.empty)+" ")]),r("footer",[r("div",{staticClass:"limit"},[r("select",{domProps:{value:t.storedLimit},on:{input:function(s){return t.onLimit(s.target.value)}}},[t._l([10,25,50],function(s){return r("option",{key:s,domProps:{value:s}},[t._v(" "+t._s(s)+" ")])}),r("option",{attrs:{value:"all"}},[t._v(" "+t._s(t.$t("retour.table.perPage.all"))+" ")])],2),t._v("\xA0"+t._s(t.$t("retour.table.perPage.after"))+" ")]),r("k-pagination",{attrs:{details:!0,limit:t.limit,page:t.page,total:t.rows.length},on:{paginate:t.onPaginate}}),r("div")],1)],1)},pt=[],Me="";const ht={props:{name:String,columns:Object,options:Array,rows:{type:Array,default(){return[]}},empty:String},data(){return{page:1,storedLimit:sessionStorage.getItem("retour$"+this.name+"$limit")||10}},computed:{paginatedRows(){return!this.limit||this.limit==="all"?this.rows:this.rows.slice(this.limit*(this.page-1),this.limit*this.page)},limit(){return this.storedLimit==="all"?this.rows.length:parseInt(this.storedLimit)}},methods:{onLimit(t){this.page=1,this.storedLimit=t,sessionStorage.setItem("retour$"+this.name+"$limit",t)},onOption(t,e,r){this.$emit("option",t,e,r)},onPaginate(t){this.page=t.page}}},m={};var ft=n(ht,vt,pt,!1,mt,null,null,null);function mt(t){for(let e in m)this[e]=m[e]}var $=function(){return ft.exports}(),$t=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("k-view",[r("list",{attrs:{name:"redirects",columns:t.columns,empty:t.$t("retour.redirects.empty"),options:t.options,rows:t.data},on:{cell:function(s){return t.onOption("edit",s.row,s.rowIndex,s.columnIndex)},option:t.onOption},scopedSlots:t._u([{key:"button",fn:function(){return[r("k-button",{attrs:{icon:"add"},on:{click:function(s){return t.onOption("create")}}},[t._v(" "+t._s(t.$t("add"))+" ")])]},proxy:!0}])})],1)},yt=[];const bt={components:{List:$},props:{data:Object,hasLog:Boolean},computed:{columns(){let t={from:{label:this.$t("retour.redirects.from"),type:"path",width:"7/20"},to:{label:this.$t("retour.redirects.to"),type:"path",width:"7/20"},status:{label:this.$t("retour.redirects.status"),type:"status",width:"1/10"},priority:{label:this.$t("retour.redirects.priority.abbr"),type:"priority",width:"1/20"}};return this.hasLog&&(t.hits={label:this.$t("retour.hits"),width:"1/10",type:"count"}),t},options(){return[{text:this.$t("edit"),icon:"edit",click:"edit"},{text:this.$t("remove"),icon:"trash",click:"delete"}]}},methods:{onOption(t,e={},r=null,s=null){if(t==="create")return this.$dialog("retour/redirects/create");const a=encodeURIComponent(e.from);return this.$dialog(`retour/redirects/${a}/${t}`,{query:{column:s}})}}},y={};var gt=n(bt,$t,yt,!1,kt,null,null,null);function kt(t){for(let e in y)this[e]=y[e]}var xt=function(){return gt.exports}(),wt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("k-view",[r("list",{attrs:{name:"failures",columns:t.columns,empty:t.$t("retour.failures.empty"),options:t.options,rows:t.data},on:{option:t.onOption},scopedSlots:t._u([{key:"button",fn:function(){return[r("k-button",{attrs:{icon:"trash"},on:{click:function(s){return t.$dialog("retour/failures/flush")}}},[t._v(" "+t._s(t.$t("retour.failures.clear"))+" ")])]},proxy:!0}])})],1)},Yt=[];const jt={components:{List:$},props:{data:Object},computed:{columns(){return{path:{label:this.$t("retour.failures.path"),type:"path",width:"1/2"},referrer:{label:this.$t("retour.failures.referrer"),type:"path",width:"1/2"},hits:{label:this.$t("retour.hits"),type:"count",width:"1/12",align:"right"}}},options(){return[{text:this.$t("retour.failures.resolve"),icon:"add",click:"resolve"},{text:this.$t("remove"),icon:"trash",click:"delete"}]}},methods:{onOption(t,e){const r=encodeURIComponent(e.path);return this.$dialog(`retour/failures/${r}/${t}`)}}},b={};var Mt=n(jt,wt,Yt,!1,St,null,null,null);function St(t){for(let e in b)this[e]=b[e]}var Ot=function(){return Mt.exports}(),Ct=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("k-view",{staticClass:"retour-plugin-tab"},[r("header",[r("h3",[r("k-icon",{attrs:{type:"road-sign"}}),t._v(" Retour for Kirby")],1)]),r("k-stats",{attrs:{reports:t.reports}}),r("footer",[r("k-text",{attrs:{theme:"help"},domProps:{innerHTML:t._s(t.$t("retour.system.docs",{docs:"https://github.com/distantnative/retour-for-kirby"}))}})],1)],1)},Ft=[],Se="";const Rt={props:{data:Object},computed:{reports(){return[{label:this.$t("retour.system.redirects"),value:this.data.redirects},{label:this.$t("retour.system.failures"),value:this.data.failures},{label:this.$t("retour.system.deleteAfter"),value:this.$t("retour.system.deleteAfter.months",{count:this.data.deleteAfter})},{label:this.$t("retour.system.support"),value:`\u{1F49B} ${this.$t("retour.system.support.donate")}`,link:"https://paypal.me/distantnative",theme:"positive"}]}}},g={};var Pt=n(Rt,Ct,Ft,!1,Dt,null,null,null);function Dt(t){for(let e in g)this[e]=g[e]}var At=function(){return Pt.exports}(),Et=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("k-inside",{staticClass:"retour"},[t.stats?[r("stats",{attrs:{data:t.stats,timespan:t.timespan}}),r("navigation",{attrs:{tab:t.tab,tabs:t.tabs,timespan:t.timespan}})]:t._e(),r(""+t.tab+"-tab",{tag:"component",attrs:{data:t.data,"has-log":!!t.stats}})],2)},Lt=[];const Nt={components:{Stats:dt,Navigation:W,FailuresTab:Ot,RedirectsTab:xt,SystemTab:At},props:{data:[Object,Array],stats:[Boolean,Array],tab:String,tabs:Array,timespan:Array}},k={};var It=n(Nt,Et,Lt,!1,Tt,null,null,null);function Tt(t){for(let e in k)this[e]=k[e]}var Ht=function(){return It.exports}(),Bt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"k-count-preview-field",attrs:{title:t.title}},[t.row.hits>0?[t._v(" "+t._s(t.row.hits)+" "),r("k-icon",{attrs:{title:t.title,type:"clock"}})]:r("p",[t._v("\u2013")])],2)},Ut=[],Oe="";const qt={props:{row:Object},computed:{title(){return this.$t("retour.hits.last")+": "+this.row.last}}},x={};var Vt=n(qt,Bt,Ut,!1,Zt,null,null,null);function Zt(t){for(let e in x)this[e]=x[e]}var zt=function(){return Vt.exports}(),Wt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("p",{staticClass:"k-url-field-preview k-path-field-preview"},[r("k-link",{attrs:{to:t.link,title:t.column.label+": "+t.value},nativeOn:{click:function(s){s.stopPropagation()}}},[t._v(" "+t._s(t.value)+" ")])],1)},Xt=[];const Kt={props:{column:{type:Object,default(){return{}}},field:Object,value:[String,Object]},computed:{isExternal(){return this.value&&this.value.startsWith("http")},link(){return this.isExternal?this.value:window.panel.$urls.site+"/"+this.value}}},w={};var Gt=n(Kt,Wt,Xt,!1,Jt,null,null,null);function Jt(t){for(let e in w)this[e]=w[e]}var Qt=function(){return Gt.exports}(),te=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"k-priority-field-preview"},[t.value?r("k-icon",{attrs:{type:"bolt",title:t.column.label}}):r("p",[t._v("\u2013")])],1)},ee=[],Ce="";const re={props:{value:String,column:Object}},Y={};var se=n(re,te,ee,!1,ae,null,null,null);function ae(t){for(let e in Y)this[e]=Y[e]}var ne=function(){return se.exports}(),j={computed:{color(){return this.value?parseInt(this.value)>=400?"var(--color-negative-light)":parseInt(this.value)>=300?"var(--color-positive-light)":"var(--color-focus-light)":"var(--color-border)"}}},ie=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"k-status-field-preview",attrs:{title:t.column.label+": "+(t.value||"-")}},[r("k-icon",{style:"color: "+t.color,attrs:{type:"circle"}}),t.value?r("code",[t._v(t._s(t.value))]):r("span",[t._v("\xA0\u2013")])],1)},oe=[],Fe="";const le={mixins:[j],props:{value:String,row:Object,column:Object}},M={};var ue=n(le,ie,oe,!1,ce,null,null,null);function ce(t){for(let e in M)this[e]=M[e]}var _e=function(){return ue.exports}(),de=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("k-field",t._b({staticClass:"k-select-field",attrs:{input:t._uid}},"k-field",t.$props,!1),[r("k-input",t._g(t._b({ref:"input",attrs:{id:t._uid,type:"select",theme:"field"},on:{input:t.onInput},scopedSlots:t._u([{key:"before",fn:function(){return[r("k-icon",{attrs:{type:"circle",color:t.color}})]},proxy:!0}])},"k-input",t.$props,!1),t.$listeners))],1)},ve=[];const pe={extends:"k-select-field",mixins:[j],methods:{onInput(t){this.value=t}}},S={};var he=n(pe,de,ve,!1,fe,null,null,null);function fe(t){for(let e in S)this[e]=S[e]}var me=function(){return he.exports}();panel.plugin("distantnative/retour",{components:{"k-count-field-preview":zt,"k-path-field-preview":Qt,"k-priority-field-preview":ne,"k-status-field-preview":_e,"k-retour-view":Ht},fields:{"rt-status":me}})})();})();
